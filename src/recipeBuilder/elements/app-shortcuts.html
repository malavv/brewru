<link rel="import" href="../bower_components/polymer/polymer.html">

<polymer-element
    name="app-shortcuts"
    attributes="isHidden"
    horizontal center-justified layout>
  <template>
    <link rel="stylesheet" href="../css/app-shortcuts.css">
    <div class="key-container">
      <template repeat="{{shortcut in shortcuts}}" >
        <div class="key-shortcut" horizontal layout>
          <div class="key-binding">{{shortcut.binding}}</div>
          <div class="key-description">{{shortcut.name}}</div>
        </div>
      </template>
    </div>
  </template>
  <script>
  Polymer('app-shortcuts', {
    busEvt: 'Shortcuts',
    shortcuts: [
      {
        binding: 'alt+S',
        name: 'Create new step',
        intent: 'CreateStep'
      },
      {
        binding: 'shift+6',
        name: 'Toggle Visibility of Shortcuts',
        intent: 'Shortcuts'
      },
      {
        binding: 'esc',
        name: 'Cancel current action.',
        intent: 'Cancel'
      }
    ],
    // Control
    map: {},
    isVisible: false,
    isDebug: false,

    ready: function() { require(['base/bus', 'base/key'], this.onReady.bind(this)); },
    onReady: function(bus, Key) {
      this.shortcuts.forEach(function(s) { this.map[s.binding] = s; }, this);
      window.bus.register(this, this.busEvt);
      this.setVisible(false);
    },
    onShortcuts: function(data) {
      this.isVisible = !this.isVisible;
      this.setVisible(this.isVisible);
    },
    keypress: function(Key, e, detail, sender) {
      var
        key = Key.fromEvent(e),
        shortcut = this.map[key.toString()];
      if (shortcut === undefined) return;
      if (this.isDebug) console.log('keypress', key, shortcut)
      if (shortcut) window.bus.broadcast(shortcut.intent);
    },
    setVisible: function(isVisible) {
      this.hidden = !isVisible;
    },
  });
  </script>
</polymer-element>