<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/core-overlay/core-overlay.html">

<polymer-element
    name="app-shortcuts"
    horizontal center-justified layout>
  <template>
    <link rel="stylesheet" href="../css/app-shortcuts.css">

    <core-overlay id="overlay">
      <div class="title">Keyboard Shortcuts</div>
      <template repeat="{{shortcut in listed}}">
        <div class="key" horizontal layout>
          <div class="shortcut">{{shortcut.binding}}</div>
          <div class="text">{{shortcut.name}}</div>
        </div>
      </template>
    </core-overlay>
  </template>
  <script>
  'use strict';

  var tmp;
  Polymer('app-shortcuts', {
    evt: 'Shortcuts',
    listed: [],
    ready: function() {
      require(['base/bus', 'base/key', 'shortcuts'], this.onReady.bind(this));
    },
    onReady: function(bus, Key, Shortcuts) {
      tmp = { bus: bus, Key: Key, Shortcuts: Shortcuts };
      this.listed = Shortcuts.all;
      console.log('onReady', Shortcuts);
      window.bus.register(this, this.evt);
      this.$.overlay.close();
    },
    onShortcuts: function(data) {
      this.$.overlay.open();
    },
    keypress: function(Key, e, detail, sender) {
      var
        key = Key.fromEvent(e),
        shortcut = tmp.Shortcuts.map[key.toString()];
      if (shortcut === undefined) return;
      if (this.isDebug) console.log('keypress', key, shortcut)
      if (shortcut) window.bus.broadcast(shortcut.intent);
    }
  });
  </script>
</polymer-element>