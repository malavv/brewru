<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/core-list/core-list.html">

<polymer-element
    name="app-menu"
    horizontal center-justified layout>
  <template>
    <link rel="stylesheet" href="../css/app-menu.css">
    <div id="test" class="container" vertical layout>
      <core-list data="{{items}}" selection="{{selection}}" flex>
        <template>
          <div class="item {{ {selected: selected} | tokenList }}" horizontal layout>
            <div class="idx">{{index | toSingleCharIdx}}</div>
            <div class="value">{{model}}</div>
          </div>
        </template>
      </core-list>
    </div>
  </template>
  <script>
  Polymer('app-menu', {
    evt: {
      send: 'AskMenu',
      receive: 'AnswerMenu'
    },
    items: [],
    selection: undefined,

    ready: function() { require(['base/bus'], this.onReady.bind(this)); },
    onReady: function() {
      window.bus.register(this, this.evt.send);
      this.setVisible(false);
    },
    onAskMenu: function(data) {
      this.items = data;
      this.setVisible(true);
    },
    handleEvent: function(e) {
      var
        key = String.fromCharCode(event.keyCode || event.which),
        idx = codes.indexOf(key)

      if (idx === -1) return; // not in codes
      if (idx >= this.items.length) return; // Outside possibilities

      window.bus.broadcast(this.evt.receive, {selected: this.selection, array: this.items});
      this.setVisible(false);
    },

    selectionChanged: function(o, n) {
      console.log('selectionChanged', o, n);
    },

    setVisible: function(isVisible) {
      this.hidden = !isVisible;
      if (isVisible)
        window.addEventListener('keypress', this, true);
      else
        window.removeEventListener('keypress', this, true);
    },
  });
  </script>
</polymer-element>