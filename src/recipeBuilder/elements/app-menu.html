<link rel="import" href="../bower_components/polymer/polymer.html">

<polymer-element
    name="app-menu"
    attributes="isHidden"
    horizontal center-justified layout>
  <template>
    <link rel="stylesheet" href="../css/app-menu.css">
    <div class="container">
      <template repeat="{{item, idx in menuItems}}" >
        <div class="choice" horizontal layout>
          <div class="idx">{{idx | itoc}}</div>
          <div class="message">{{item}}</div>
        </div>
      </template>
    </div>
  </template>
  <script>
  var
    codes = '0123456789abcdefghijklmnopqrstuvqxyz';

  Polymer('app-menu', {
    isHidden: true,
    menuItems: [],

    itoc: function(i) { return codes[i]; },
    ready: function() { require(['base/bus'], this.onReady.bind(this)); },
    onReady: function() {
      window.bus.register(this, 'AskMenu');
    },
    onAskMenu: function(data) {
      this.menuItems = data;
      this.isHidden = false;
      window.addEventListener('keypress', this, true);
    },
    handleEvent: function(e) {
      var
        key = String.fromCharCode(event.keyCode || event.which),
        idx = codes.indexOf(key)

      if (idx === -1) return; // not in codes
      if (idx >= this.menuItems.length) return; // Outside possibilities

      window.bus.broadcast('AnswerMenu', {selected: this.menuItems[idx], array: this.menuItems});
      window.removeEventListener('keypress', this, true);
      this.isHidden = true;
    }
  });
  </script>
</polymer-element>