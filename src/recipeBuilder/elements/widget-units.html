<link rel="import" href="polymer-require.html">

<polymer-element
    name="widget-units"
    attributes="unit"
    vertical center-justified layout
    on-mouseover='{{onHoverIn}}' on-mouseout='{{onHoverOut}}'>
  <template>
    <link rel="stylesheet" href="../css/widget-units.css">
    <div class="container">
      <div class="title">{{title}}</div>

      <div class="system us"
          hidden?={{!isExpanded}}
          on-mouseover='{{onHoverIn}}'
          on-mouseout='{{onHoverOut}}'>
        <div class="name">US Cust.</div>
        <ul>
          <template repeat="{{unit, idx in USCust}}">
            <li on-tap={{onChoice}} data-system="USCust" data-unit={{idx}}>{{unit}}</li>
          </template>
        </ul>
      </div>

      <div class="system si"
          hidden?={{!isExpanded}}
          on-mouseover='{{onHoverIn}}'
          on-mouseout='{{onHoverOut}}'>
        <div class="name">SI</div>
        <ul>
          <template repeat="{{unit, idx in SI}}">
            <li on-tap={{onChoice}} data-system="SI" data-unit={{idx}}>{{unit}}</li>
          </template>
        </ul>
      </div>
    </div>

  </template>
  <script>
  Polymer.require('widget-units',
    ['base/units'],
    function(Units) {
      return {
        USCust: [],
        SI: [],

        isExpanded: false,
        ref: 0,

        unit: undefined,
        title: 'Units',

        ready: function() {
          Object.keys(Units.USCust.Mass).forEach(function(v) { this.USCust.push(Units.USCust.Mass[v]); }, this);
          Object.keys(Units.USCust.Volume).forEach(function(v) { this.USCust.push(Units.USCust.Volume[v]); }, this);
          Object.keys(Units.USCust.Length).forEach(function(v) { this.USCust.push(Units.USCust.Length[v]); }, this);
          Object.keys(Units.SI.Mass).forEach(function(v) { this.SI.push(Units.SI.Mass[v]); }, this);
          Object.keys(Units.SI.Volume).forEach(function(v) { this.SI.push(Units.SI.Volume[v]); }, this);
          Object.keys(Units.SI.Length).forEach(function(v) { this.SI.push(Units.SI.Length[v]); }, this);
        },
        onHoverIn: function() {
          this.isExpanded = true;
          this.ref += 1;
        },
        onHoverOut: function() {
          var self = this;
          window.setTimeout(function() {
            self.ref = self.ref > 0 ? self.ref - 1 : 0;
            if (self.ref === 0)
              self.isExpanded = false;
          }, 100)
        },
        onChoice: function(a, b, c) {
          this.unit = this[c.dataset.system][c.dataset.unit];
          this.isExpanded = false;
          this.ref = 0;
        },
        unitChanged: function(oldValue, newValue) {
          if (newValue !== '') this.title = newValue;
          else this.title = 'Units';
        }
      };
    }
  );
  </script>
</polymer-element>