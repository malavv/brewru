<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/core-overlay/core-overlay.html">

<polymer-element
    name="app-text"
    horizontal center-justified layout>
  <template>
    <link rel="stylesheet" href="../css/app-text.css">

    <core-overlay id="overlay" on-core-overlay-close-completed="{{onOverlayClosed}}">
      <paper-input id="value" label="{{description}}" value="{{value}}" committedValue="{{committed}}" flex>
      </paper-input>
    </core-overlay>
  </template>
  <script>
  (function() {
  Polymer('app-text', {
    busRequest: 'AskText',
    busCancel: 'Cancel',

    evtSend: 'AnswerText',

    description: '',
    wasCanceled: true,

    ready: function() { require(['base/bus'], this.onReady.bind(this)); },
    onReady: function() {
      window.bus.register(this, [this.busRequest, this.busCancel]);
    },

    onAskText: function(data) {
      this.description = data;
      this.value = '';
      this.open();
    },
    committedChanged: function(oldV, newV) {
      if (newV === "") return;
      this.wasCanceled = false;
      this.$.overlay.close();
    },
    /** On cancel received. */
    onCancel: function() {
      if (this.$.overlay.opened)
        this.$.overlay.close();
    },
    /** Main closing exit point. */
    onOverlayClosed: function() {
      this.close();
    },
    getResults: function() {
      return {
        description: this.description,
        value: this.value
      };
    },

    reset: function() {
      this.description = '';
      this.value = '';
      this.wasCanceled = true;
    },
    open: function () {
      this.$.overlay.open();
    },
    close: function () {
      window.bus.broadcast(this.evtSend, this.wasCanceled ? null : this.getResults());
      this.reset();
    }
  });
  })()
  </script>
</polymer-element>