<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/paper-input/paper-input.html">

<polymer-element
    name="app-text"
    horizontal center-justified layout>
  <template>
    <link rel="stylesheet" href="../css/app-text.css">
    <div class="container" horizontal layout>
      <paper-input id="value" label="{{description}}" committedValue="{{value}}" flex></paper-input>
    </div>
  </template>
  <script>
  Polymer('app-text', {
    // events
    evtReceive: 'AskText',
    evtSend: 'AnswerText',
    // control
    description: '',
    // value
    value: '',

    ready: function() { require(['base/bus'], this.onReady.bind(this)); },
    onReady: function() {
      window.bus.register(this, this.evtReceive);
      this.setVisible(false);
    },
    onAskText: function(data) {
      this.description = data;
      this.setVisible(true);
      // I have no idea why I need to do this, but straight calling focus is an uther failure.
      var self = this;
      window.setTimeout(function() { self.$.value.focus(); }, 0);
    },
    valueChanged: function(oldValue, newValue) {
      if (newValue === undefined) return;
      window.bus.broadcast(this.evtSend, this.getResults());
      this.reset();
      this.setVisible(false);
    },
    getResults: function() {
      return {
        description: this.description,
        value: this.committedValue
      };
    },
    setVisible: function(isVisible) {
      this.hidden = !isVisible;
    },
    reset: function() {
      this.description = '';
      this.value = '';
      this.$.value.value = '';
    }
  });
  </script>
</polymer-element>