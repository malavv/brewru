<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="recipe-graph.html">
<link rel="import" href="recipe-reactor.html">
<link rel="import" href="recipe-tools.html">
<link rel="import" href="recipe-newstep.html">
<link rel="import" href="app-shortcuts.html">
<link rel="import" href="app-menu.html">
<link rel="import" href="widget-text.html">

<polymer-element name="recipe-overview" vertical layout>
	<template>
    <link rel="stylesheet" href="../css/recipe-overview.css">
    <widget-text class="recipeName" text={{recipe.name}}></widget-text>
    <div horizontal layout flex>
      <recipe-graph recipe={{recipe}} flex one></recipe-graph>
      <recipe-reactor reactor={{reactor}} flex four></recipe-reactor>
      <recipe-tools reactor={{reactor}} inventory={{inventory}} flex one></recipe-tools>
    </div>
    <app-shortcuts id="shortcuts" isHidden={{isShortcutHidden}} hidden?={{isShortcutHidden}}></app-shortcuts>
    <app-menu isHidden={{isMenuHidden}} hidden?={{isMenuHidden}}></app-menu>
    <recipe-newstep></recipe-newstep>
	</template>
	<script>
    var Key;
    Polymer('recipe-overview', {
      recipeChanged: function() {
        this.reactor = this.recipe.reactors[0];
      },
      ready: function() {
        require(['recipebuilder', 'base/key'], this.onReady.bind(this))
      },
      onReady: function(RecipeBuilder, key) {
        Key = key;
        this.initRecipeBuilder(RecipeBuilder);
        window.addEventListener('keyup', this.$.shortcuts.keypress.bind(this.$.shortcuts, Key), true);
      },
      initRecipeBuilder: function(RecipeBuilder) {
        this.builder = new RecipeBuilder();
        this.inventory = this.builder.inventory;
        this.recipe = this.builder.recipe;
      }
    });
  </script>
</polymer-element>