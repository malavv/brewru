<link rel="import" href="../bower_components/polymer/polymer.html">

<polymer-element name="widget-text" attributes="text" on-tap={{onTap}}>
  <template>
  	<template if="{{isEditMode}}">
      <input type="text" value={{text}} on-keypress={{onKey}}/>
    </template>
    <template if="{{!isEditMode}}">
      {{text}}
    </template>
  </template>
	<script>
  var Key;
	Polymer('widget-text', {
    isEditMode: false,
    ready: function() {
      require(['base/key'], function(key) { Key = key; });
    },
    onTap: function() {
      if (this.isEditMode) return false
      this.onEnterEditMode();
      return false;
    },
    onKey: function(e) {
      var
        key = Key.fromEvent(e).toString();
      if (key !== 'enter') return false;
      this.onExitEditMode();
      return false;
    },
    onEnterEditMode: function() {
      console.log('onEnterEditMode');
      this.isEditMode = true;
    },
    onExitEditMode: function() {
      console.log('onExitEditMode');
      this.isEditMode = false;
      this.fire('changed');
    }
	});
	</script>
</polymer-element>